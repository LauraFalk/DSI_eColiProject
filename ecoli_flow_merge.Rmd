---
title: "eColi_Flow_Merge"
author: "Laura Palacios"
date: '2022-09-02'
output: html_document
---

install libraries
```{r setup, include=FALSE}
library(knitr)
library(dataRetrieval)
library(lubridate)
library(data.table)
library(measurements)
library(ggplot2)
```


Read in input file
note: this will have one extra variable if csv is exported and re-imported because column 1 (ID) will be added to file.
```{r}
#Part of a project, this is not necessary if previous files have been run.
#eColi_FileName <- "Data/Processed/ecoli_ForAnalysis.csv"
#ecoli_Flow_Merge <- read.csv(eColi_FileName)

```

read in USGS file
```{r}
#Part of a project, this is not necessary if previous files have been run.
#USGS <- read.csv("Data/Raw/USGS_09481740.csv")
```

Create Date/Time column in e coli file.
```{r}
ecoli_Flow_Merge$DateTime <- mdy_hms(paste(ecoli_Flow_Merge$ActivityStartDate,
                                           ecoli_Flow_Merge$ActivityStartTime.Time),tz="America/Phoenix")
#Ensure it is date-transformed correctly because datetimes are a pain. Round to the nearest quarter hour to match with flow levels from gage
ecoli_Flow_Merge$DateTime1 <- round_date(as.POSIXct(ecoli_Flow_Merge$DateTime), "15 minutes")
ecoli_Flow_Merge$DateTime1 <-format(as.POSIXct(ecoli_Flow_Merge$DateTime1), format = '%Y-%m-%d %H:%M')

```

Ensure Date/Time column in USGS file is a date/time. Unique name (1) so that merge is easier later.
```{r}
USGS$DateTime2 <-format(as.POSIXct(USGS$dateTime), format = '%Y-%m-%d %H:%M')
```

Change column names to something recognizable and convert flow to inch for maximum change detection.
```{r}
#Set column name
setnames(USGS,old=c("X_00060_00000", "X_00065_00000"),new=c("Discharge_CFS", "USGS_Depth_ft"))
USGS$USGS_Depth_in <-conv_unit(USGS$USGS_Depth_ft, "ft", "inch")
```

create merged file for graphs and tables
```{r}
Outputtest<-
  merge(x = ecoli_Flow_Merge[ , c("DateTime1","X")], 
        y = USGS[ , c("DateTime2", "Discharge_CFS", "USGS_Depth_in")], 
        by.x='DateTime1', by.y = 'DateTime2', all.x=TRUE) 
```

```{r}
#Check this merge
library(dplyr)
test <- Outputtest %>%
  filter(Discharge_CFS == NULL)
```









