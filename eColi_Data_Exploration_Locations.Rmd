---
title: "Results_Locations_PointSource"
author: "Laura Palacios"
date: '2022-09-01'
output: html_document
---

```{r setup, include=FALSE}
#library(dplyr)
library(knitr)
library(lubridate)
opts_chunk$set(echo = TRUE)
```

#Summary notes
I have raw data from the water quality portal (EPA) a summary of ADEQ, USGS, FOSCR and NPS (Tumacacori) data plus a download of NPS-SODN quarterly sampling data. These files were merged together.

The locations for data download were chosen from the Upper Santa Cruz River. Locations are limited to North of the NIWWTP and Sonoita Creek confluence to avoid data noise from two likely point sources. All locations sampled should contain the same water without significant other inputs.

The data was limited to:
1. sample location (above)
2. E. coli only (not total coliforms)
3. same method (EPA Standard Method 9223B, Colilert, sampling procedures)
4. comparable date range (Post 2009 NIWWTP significant upgrade project)


#Steps Below
Read in the raw data files
```{r}
#setwd("C:/Users/Laura/Desktop/DSI_Project/Data/")
RawFileName <- "Data/Raw/EPA_PortalQuery_Appended_SODN.csv"

#Current file uses points lassoed in arcmap. It uses any sampling locations north of inputs from both the Nogales WWTP and Sonoita Creek in case either of these are point sources of e. Coli.
LocationFileName <- "Data/Raw/EPA_PortalQuery_Locations_Appended_SODN.csv"
coliform_data <- read.csv(RawFileName)
Locations <- read.csv(LocationFileName)
```

Remove raw columns that are fecal coliform or other bacteria.

CharacteristicName == Escherichia coli
fecal coliforms may be applicable, but I am limiting my study to after the NIWWT update in 2009.
 or 
```{r}
ecoli_data <- coliform_data[coliform_data$CharacteristicName == "Escherichia coli", ]  
```

Remove columns with methods other than 9223B

```{r}
ecoli_data_9223b <- ecoli_data[ecoli_data$ResultAnalyticalMethod.MethodName == "E coli, water, Colilert (24-28)"|
                                    ecoli_data$ResultAnalyticalMethod.MethodName ==  "COLILERT (EDBERG)"|
                                    ecoli_data$ResultAnalyticalMethod.MethodName ==  "COLILERT"|
                                    ecoli_data$ResultAnalyticalMethod.MethodName ==  "SM 9223B", ] 
```

Remove dates before 2009 when the plant was updated. June 2009
```{r}
ecoli_data_9223b$DateAsDate <- mdy(ecoli_data_9223b$ActivityStartDate,tz="America/Phoenix")
ecoli_data_9223b$DateAsDate <-format(as.POSIXct(ecoli_data_9223b$DateAsDate),format='%Y-%m-%d')
ecoli_data_9223b_date <- ecoli_data_9223b[ecoli_data_9223b$DateAsDate >= "2009-07-01", ] 
```



Merge the files based on monitoring location identifier
# this will decrease the number of rows in the dataset because it excludes measurements outside of the study range (namely the sonoita creek data)
```{r}
ecoli_ForAnalysis <- merge(ecoli_data_9223b_date, Locations, by = c("MonitoringLocationIdentifier"))

```
